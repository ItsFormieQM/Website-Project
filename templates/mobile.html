<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>probably undertale</title>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "DETERMINATION SANS", monospace;
  }

  body {
    background: blue;
    color: white;
    overflow: hidden;
  }

  canvas {
    display: block;
    image-rendering: pixelated;
    touch-action: none; /* IMPORTANT for mobile */
  }
</style>
</head>

<body>
<canvas id="gameCanvas"></canvas>

<script>
// ---------- CANVAS SETUP ----------
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ---------- PLAYER SETUP ----------
const playerImg = new Image();
playerImg.src = "sprites/redsoul.png"; // initial player image

const player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  size: 24,
  speed: 3.5,
  img: playerImg  // store image in object
};

// ---------- FUNCTION TO CHANGE PLAYER IMAGE ----------
function changePlayerImage(newSrc) {
  player.img.src = newSrc;
}

// ---------- KEYBOARD INPUT ----------
const keys = {};
window.addEventListener("keydown", e => { keys[e.key.toLowerCase()] = true; });
window.addEventListener("keyup", e => { keys[e.key.toLowerCase()] = false; });

// ---------- POINTER INPUT (MOUSE + TOUCH) ----------
let pointerDown = false;
let pointerPos = { x: player.x, y: player.y };

canvas.addEventListener("pointerdown", e => {
  pointerDown = true;
  pointerPos.x = e.clientX;
  pointerPos.y = e.clientY;
  canvas.setPointerCapture(e.pointerId);
});

canvas.addEventListener("pointerup", e => {
  pointerDown = false;
  canvas.releasePointerCapture(e.pointerId);
});

canvas.addEventListener("pointermove", e => {
  if (pointerDown) {
    pointerPos.x = e.clientX;
    pointerPos.y = e.clientY;
  }
});

// ---------- GAME LOOP ----------
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Pointer movement (drag toward touch/mouse)
  if (pointerDown) {
    const dx = pointerPos.x - (player.x + player.size / 2);
    const dy = pointerPos.y - (player.y + player.size / 2);

    player.x += Math.sign(dx) * Math.min(Math.abs(dx), player.speed);
    player.y += Math.sign(dy) * Math.min(Math.abs(dy), player.speed);
  }

  // Keep player inside screen
  player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
  player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));

  // Draw player image
  ctx.drawImage(player.img, player.x, player.y, player.size, player.size);

  requestAnimationFrame(gameLoop);
}

gameLoop();

// ---------- EXAMPLE: CHANGE IMAGE AFTER 2 SECONDS ----------
setTimeout(() => {
  changePlayerImage("/static/sprites/red.png");
}, 0);

</script>
</body>
</html>
